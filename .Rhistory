getwd()
library(dplyr)
library(tidyr)
library(forcats)
library(readxl)
library(ggplot2)
getwd()
library(here)
folder <- here('oregon_status')
folder
list.files(folder)
filenames <- list.files(folder)
str_match(filenames[1], "COVID-19 SCHOOL STATUS REPORT \\s*(.*?)\\s* to ")
library(stringr)
str_match(filenames[1], "COVID-19 SCHOOL STATUS REPORT \\s*(.*?)\\s* to ")
str_match(filenames[2], "COVID-19 SCHOOL STATUS REPORT \\s*(.*?)\\s* to ")
??readxl
filenames <- list.files(folder, full.names = T) ## list all excel files
filenames[1]
read_excel(filenames[1])
read_excel(filenames[26])
read_excel(filenames[25])
read_excel(filenames[26])
df <- read_excel(filenames[26])
View(df)
filenames <- list.files(folder, full.names = T) ## list all excel files
read_excel(filenames[1])
for (n in 1:length(filenames))
{
x[[n]] = read_excel(filenames[n]) #read SAS file
x[[n]]$week = dataname[n] #add column indicating file/data name
}
x <- list()
folder <- here('oregon_status')
filenames <- list.files(folder, full.names = T) ## list all excel files
for (n in 1:length(filenames))
{
x[[n]] = read_excel(filenames[n]) #read SAS file
x[[n]]$week = dataname[n] #add column indicating file/data name
}
x <- list()
folder <- here('oregon_status')
filenames <- list.files(folder, full.names = T) ## list all excel files
for (n in 1:length(filenames))
{
x[[n]] = read_excel(filenames[n]) #read SAS file
x[[n]]$week = str_match(filenames[n], "COVID-19 SCHOOL STATUS REPORT \\s*(.*?)\\s* to ")[2] #add column indicating week
}
View(x)
filenames <- list.files(folder,pattern = "\\.xlsx", full.names = T) ## list all excel files
for (n in 1:length(filenames))
{
x[[n]] = read_excel(filenames[n]) #read SAS file
x[[n]]$week = str_match(filenames[n], "COVID-19 SCHOOL STATUS REPORT \\s*(.*?)\\s* to ")[2] #add column indicating week
}
View(x)
do.call(x, bind_rows)
do.call(bind_rows,x)
rlang::last_error()
do.call(x, plyr::rbind.fill())
do.call(plyr::rbind.fill(),x)
do.call(plyr::rbind.fill,x)
sch_stat <- do.call(plyr::rbind.fill,x)
colnames(sch_stat)
View(sch_stat)
sum(is.na(sch_stat$`School County`))
sum(is.na(sch_stat$County))
View(x)
sum(is.na(sch_stat$`Week Starting`))
sum(is.na(sch_stat$`Week`))
head(sch_stat)
View(sch_stat)
sch_stat %>% filter(is.na(week))
sch_stat %>% filter(is.na(`Institution #`))
sch_stat %>% filter(is.na(`Institution #`)) %>% unique(week)
sch_stat %>% filter(is.na(`Institution #`)) %>% select(week) %>% unique()
sch_stat %>% filter(is.na(`Institution ID#`)) %>% select(week) %>% unique()
colnames(df)
colnames(sch_stat)
x <- list()
folder <- here('oregon_status')
filenames <- list.files(folder,pattern = "\\.xlsx", full.names = T) ## list all excel files
for (n in 1:length(filenames))
{
x[[n]] = read_excel(filenames[n]) #read SAS file
x[[n]]$week = str_match(filenames[n], "COVID-19 SCHOOL STATUS REPORT \\s*(.*?)\\s* to ")[2] #add column indicating week
}
sch_stat <- do.call(plyr::rbind.fill,x)
View(sch_stat)
View(sch_stat)
sch_stat %>% select('Week Starting')
sch_stat %>% select('Week Starting') %>% arrange()
sch_stat %>% select('Week Starting') %>% unique()
sch_stat %>% select('Week Starting') %>% unique() %>% arrange()
unique(sch_stat$`Operating Status`)
colnames(sch_stat)
colnames(sch_stat)[1:5] <- c("ID","school_name","district","week_sr","status")
sch_stat<- sch_stat %>% mutate(
status_cat = status,
status_cat = ifelse(status == "Fully On-Site"| status = "On-Site (Green)", "on_site",
ifelse(status == "Comprehensive Distance Learning (CDL)"| status == "Distance Learning (Red)", "distance",
ifelse(status == "Hybrid"| status == "On-Site and Distance Learning (Yellow)", "hybrid",
ifelse(status == "Transition (Orange)", "transition",
ifelse(is.na(status), NA, "noclass"))))))
sch_stat %>% mutate(
status_cat = status,
status_cat = ifelse(status == "Fully On-Site"| status = "On-Site (Green)", "on_site",
ifelse(status == "Comprehensive Distance Learning (CDL)"| status == "Distance Learning (Red)", "distance",
ifelse(status == "Hybrid"| status == "On-Site and Distance Learning (Yellow)", "hybrid",
ifelse(status == "Transition (Orange)", "transition",
ifelse(is.na(status), NA, "noclass"))))))
sch_stat %>% mutate(
status_cat = status,
status_cat = ifelse(status == "Fully On-Site"| status == "On-Site (Green)", "on_site",
ifelse(status == "Comprehensive Distance Learning (CDL)"| status == "Distance Learning (Red)", "distance",
ifelse(status == "Hybrid"| status == "On-Site and Distance Learning (Yellow)", "hybrid",
ifelse(status == "Transition (Orange)", "transition",
ifelse(is.na(status), NA, "noclass"))))))
sch_stat<- sch_stat %>% mutate(
status_cat = status,
status_cat = ifelse(status == "Fully On-Site"| status == "On-Site (Green)", "on_site",
ifelse(status == "Comprehensive Distance Learning (CDL)"| status == "Distance Learning (Red)", "distance",
ifelse(status == "Hybrid"| status == "On-Site and Distance Learning (Yellow)", "hybrid",
ifelse(status == "Transition (Orange)", "transition",
ifelse(is.na(status), NA, "noclass"))))))
table(sch_stat$status_cat)
sch_stat %>% group_by(district, week, status_cat) %>% summarize(sum=n())
unique(sch_stat$week)
sch_stat%>% filter(week == "9-27") %>% group_by(district, week, status_cat) %>% summarize(sum=n())
summary <- sch_stat%>% filter(week == "9-27") %>% group_by(district, week, status_cat) %>% summarize(sum=n())
View(summary)
View(summary)
sch_stat %>% group_by(district, week, status_cat) %>%
summarize(sum=n())
??left_join
summary <- sch_stat %>% group_by(district, week, status_cat) %>%
summarize(sum=n()) %>%
left_join(sch_stat %>% group_by(district, week) %>% summarize(tot = n()),
by= c("district"="district", "week"="week"))
summary
summary <- sch_stat %>% group_by(district, week, status_cat) %>%
summarize(sum=n()) %>%
left_join(sch_stat %>% group_by(district, week) %>% summarize(tot = n()),
by= c("district"="district", "week"="week"))
View(summary)
summary <- sch_stat %>% group_by(district, week, status_cat) %>%
summarize(sum=n()) %>%
left_join(sch_stat %>% group_by(district, week) %>% summarize(tot = n()),
by= c("district"="district", "week"="week"))
View(summary)
summary %>% group_by(district, week) %>% summarize(n=n()) %>% mutate(n/sum(n))
summary %>% group_by(week) %>% summarize(n=n()) %>% mutate(n/sum(n))
summary %>% group_by(district, week) %>% summarize(n=n())
summary
summary %>% group_by(week, status_cat) %>% summarize(n=n())
summary %>% group_by(week, status_cat) %>% summarize(n=n()) %>% mutate(n/sum(n))
summary %>% group_by(week, status_cat) %>% summarize(n=n()) %>% ggplot(aes(x=week, y =n)) +geom_hist(col = status_cat)
summary %>% group_by(week, status_cat) %>% summarize(n=n()) %>% ggplot(aes(x=week, y =n)) + geom_col(col = status_cat)
summary %>% group_by(week, status_cat) %>% summarize(n=n()) %>% ggplot(aes(x=week, y =n)) + geom_bar(aes(fill=as.factor(status_cat)))
summary %>% group_by(week, status_cat) %>% summarize(n=n()) %>% ggplot(aes(x=week, fill = as.factor(status_cat) )) + geom_bar(aes(fill=as.factor(status_cat)))
summary %>% group_by(week, status_cat) %>% summarize(n=n()) %>%
ggplot(aes(x=week, y=n, fill = as.factor(status_cat) )) + geom_bar(aes(fill=as.factor(status_cat)))
summary %>% group_by(week, status_cat) %>% summarize(n=n()) %>%
ggplot(aes(x=week)) + geom_bar(mapping = aes(y = n))
summary %>% group_by(week, status_cat) %>% summarize(n=n()) %>%
ggplot(aes(x=week)) + geom_col(mapping = aes(y = n))
summary %>% group_by(week, status_cat) %>% summarize(n=n()) %>%
ggplot(aes(x=week, y = n, color = status_cat)) + geom_col(aes(group = status_cat, fill = status_cat))
summary
View(sch_stat)
sch_stat %>% filter(week == "10-11") %>% select(status) %>% unique()
summary %>% group_by(week, status_cat) %>% summarize(n=n()) %>% mutate(prop = n/sum(n))
ggplot(aes(x=week, y = prop, color = status_cat)) + geom_col(aes(group = status_cat, fill = status_cat))
summary %>% group_by(week, status_cat) %>% summarize(n=n()) %>% mutate(prop = n/sum(n)) %>%
ggplot(aes(x=week, y = prop, color = status_cat)) + geom_col(aes(group = status_cat, fill = status_cat))
?factor
factor(sch_stat$week, levels = "9-27")
unique(sch_stat$week)
unique(sch_stat$week)[1:3]
unique(sch_stat$week)[6:8]
sch_stat<- sch_stat %>% mutate(
status_cat = status,
status_cat = ifelse(status == "Fully On-Site"| status == "On-Site (Green)", "on_site",
ifelse(status == "Comprehensive Distance Learning (CDL)"| status == "Distance Learning (Red)", "distance",
ifelse(status == "Hybrid"| status == "On-Site and Distance Learning (Yellow)", "hybrid",
ifelse(status == "Transition (Orange)", "transition",
ifelse(is.na(status), NA, "noclass"))))),
week = factor(week, levels = c("9-27", "10-4", unique(sch_stat$week)[1:3], "11-1", "11-8",unique(sch_stat$week)[6:8],
unique(sch_stat$week)[10:12])))
summary <- sch_stat %>% group_by(district, week, status_cat) %>%
summarize(sum=n()) %>%
left_join(sch_stat %>% group_by(district, week) %>% summarize(tot = n()),
by= c("district"="district", "week"="week"))
summary %>% group_by(week, status_cat) %>% summarize(n=n()) %>% mutate(prop = n/sum(n)) %>%
ggplot(aes(x=week, y = prop, color = status_cat)) + geom_col(aes(group = status_cat, fill = status_cat))+
theme(axis.text.x = element_text(angle = 45))
summary %>% group_by(week, status_cat)
summary %>% mutate(prop = sum/tot) %>% filter(week == "9-27", status_cat == "on_site")
summary %>% mutate(prop = sum/tot) %>% filter(week == "9-27", status_cat == "on_site") %>% arrange(prop)
summary %>% mutate(prop = sum/tot) %>% filter(week == "9-27", status_cat == "on_site") %>% filter(prop==1)
summary %>% group_by(week, status_cat) %>% summarize(n=n()) %>% mutate(prop = n/sum(n)) %>%
ggplot(aes(x=week, y = prop, color = status_cat)) + geom_col(aes(group = status_cat, fill = status_cat))+
theme(axis.text.x = element_text(angle = 45)) + ggtitle("Estimated % school districts offering instructional models by week")
summary %>% mutate(prop = sum/tot) %>% filter(week == "9-27", status_cat == "on_site")
summary %>% mutate(prop = sum/tot) %>% filter(week == "10-4", status_cat == "on_site")
summary %>% mutate(prop = sum/tot) %>% filter(week == "9-27", status_cat == "on_site")
summary %>% mutate(prop = sum/tot) %>% group_by(week) %>%  filter(status_cat == "on_site")
sch_stat %>% group_by(week, status_cat) %>%
summarize(sum=n()) %>%
left_join(sch_stat %>% group_by(week) %>% summarize(tot = n()),
by= c("district"="district", "week"="week")) %>% group_by(week, status_cat) %>% summarize(n=n()) %>% mutate(prop = n/sum(n)) %>%
ggplot(aes(x=week, y = prop, color = status_cat)) + geom_col(aes(group = status_cat, fill = status_cat))+
theme(axis.text.x = element_text(angle = 45)) + ggtitle("Estimated % school districts offering instructional models by week")
sch_stat %>% group_by(week, status_cat) %>%
summarize(sum=n()) %>%
left_join(sch_stat %>% group_by(week) %>% summarize(tot = n()),
by= c("week"="week")) %>% group_by(week, status_cat) %>% summarize(n=n()) %>% mutate(prop = n/sum(n)) %>%
ggplot(aes(x=week, y = prop, color = status_cat)) + geom_col(aes(group = status_cat, fill = status_cat))+
theme(axis.text.x = element_text(angle = 45)) + ggtitle("Estimated % school districts offering instructional models by week")
sch_stat %>% group_by(week, status_cat) %>%
summarize(sum=n()) %>%
left_join(sch_stat %>% group_by(week) %>% summarize(tot = n()),
by= c("week"="week")) %>% group_by(week, status_cat) %>% summarize(n=n()) %>% mutate(prop = n/sum(n))
sch_stat %>% group_by(week, status_cat) %>%
summarize(sum=n())
sch_stat %>% group_by(week, status_cat) %>%
summarize(sum=n()) %>%
left_join(sch_stat %>% group_by(week) %>% summarize(tot = n()),
by= c("week"="week"))
sch_stat %>% group_by(week, status_cat) %>%
summarize(sum=n()) %>%
left_join(sch_stat %>% group_by(week) %>% summarize(tot = n()),
by= c("week"="week")) %>% group_by(week, status_cat)%>% mutate(prop = n/sum(n))
sch_stat %>% group_by(week, status_cat) %>%
summarize(sum=n()) %>%
left_join(sch_stat %>% group_by(week) %>% summarize(tot = n()),
by= c("week"="week")) %>% group_by(week)%>% mutate(prop = n/sum(n)) %>%
ggplot(aes(x=week, y = prop, color = status_cat)) + geom_col(aes(group = status_cat, fill = status_cat))+
theme(axis.text.x = element_text(angle = 45)) + ggtitle("Estimated % school districts offering instructional models by week")
sch_stat %>% group_by(week, status_cat) %>%
summarize(sum=n()) %>%
left_join(sch_stat %>% group_by(week) %>% summarize(tot = n()),
by= c("week"="week")) %>% group_by(week)%>% mutate(prop = n/sum(n))
sch_stat %>% group_by(week, status_cat) %>%
summarize(sum=n()) %>%
left_join(sch_stat %>% group_by(week) %>% summarize(tot = n()),
by= c("week"="week")) %>% group_by(week)%>% mutate(prop = sum/sum(n))
sch_stat %>% group_by(week, status_cat) %>%
summarize(sum=n()) %>%
left_join(sch_stat %>% group_by(week) %>% summarize(tot = n()),
by= c("week"="week")) %>% group_by(week)%>% mutate(prop = sum/sum(n)) %>%
ggplot(aes(x=week, y = prop, color = status_cat)) + geom_col(aes(group = status_cat, fill = status_cat))+
theme(axis.text.x = element_text(angle = 45)) + ggtitle("Estimated % school districts offering instructional models by week")
sch_stat %>% group_by(week, status_cat) %>%
summarize(sum=n()) %>%
left_join(sch_stat %>% group_by(week) %>% summarize(tot = n()),
by= c("week"="week")) %>% group_by(week)%>% mutate(prop = sum/tot) %>%
ggplot(aes(x=week, y = prop, color = status_cat)) + geom_col(aes(group = status_cat, fill = status_cat))+
theme(axis.text.x = element_text(angle = 45)) + ggtitle("Estimated % school districts offering instructional models by week")
sch_stat %>% group_by(week, status_cat) %>%
summarize(sum=n()) %>%
left_join(sch_stat %>% group_by(week) %>% summarize(tot = n()),
by= c("week"="week")) %>% group_by(week)%>% mutate(prop = sum/tot) %>%
ggplot(aes(x=week, y = prop, color = status_cat)) + geom_col(aes(group = status_cat, fill = status_cat))+
theme(axis.text.x = element_text(angle = 45)) + ggtitle("Estimated % schools offering instructional models by week")
summary %>% mutate(prop = sum/tot) %>% group_by(week) %>%  filter(status_cat == "on_site")
summary %>% mutate(prop = sum/tot)  %>%  filter(status_cat == "on_site") %>%
mutate(all_onsite = ifelse(prop ==1, 1,0)) %>% group_by(week, all_onsite) %>% summarize(n=n()) %>% mutate(n/sum(n))
## What percent of districts with some in-person have all schools in-person? A little over half I think
summary %>% mutate(prop = sum/tot)  %>%  filter(status_cat == "on_site") %>%
mutate(all_onsite = ifelse(prop ==1, 1,0)) %>% group_by(week, all_onsite) %>% summarize(n=n()) %>% mutate(n/sum(n)) %>%
filter(all_osite ==1)
## What percent of districts with some in-person have all schools in-person? A little over half I think
summary %>% mutate(prop = sum/tot)  %>%  filter(status_cat == "on_site") %>%
mutate(all_onsite = ifelse(prop ==1, 1,0)) %>% group_by(week, all_onsite) %>% summarize(n=n()) %>% mutate(n/sum(n)) %>%
filter(all_onsite ==1)
saveRDS(sch_stat, "school_stat_fall2020.RDS")
saveRDS(sch_stat, "oregon_status/school_stat_fall2020.RDS")
